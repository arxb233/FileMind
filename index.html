<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8" />
    <title>FileMind – 文件思维导图</title>

    <script src="https://cdn.jsdelivr.net/npm/markmap-autoloader@0.18"></script>

    <style>
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            font-family: "Segoe UI", Tahoma, sans-serif;
            background: #f0f2f5;
        }

        header {
            background: #276FF5;
            color: white;
            padding: 16px 24px;
            margin-bottom: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .markmap {
            flex: 1;
            display: flex;
            background: #fff;
            margin: 0 12px 12px 12px;
            border-radius: 6px;
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.1);
        }

        svg.markmap {
            width: 100%;
            height: 100%;
        }

        header h1 {
            margin: 0;
            font-size: 24px;
        }

        header p {
            margin: 4px 0 0 0;
            font-size: 14px;
            color: #d0e0ff;
        }
    </style>

    <script>
        // --------------- 点击打开文件/文件夹 ---------------
        document.addEventListener("click", (e) => {
            if (e.target.tagName === "A" && e.target.dataset.path) {
                e.preventDefault();
                fetch("/api/open", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        path: e.target.dataset.path,
                        type: e.target.dataset.type,
                    }),
                });
            }
        });

        // --------------- 加载思维导图树 ----------------
        async function loadTree() {
            const res = await fetch("/api/tree");
            const data = await res.json();
            document.querySelector("#tree-md").textContent = data.markdown;
        }

        // --------------- 加载目录统计信息 ----------------
        async function loadInfo() {
            const res = await fetch("/api/info");
            const info = await res.json();

            document.querySelector("#info-text").textContent =
                `路径: ${info.path} | 文件夹: ${info.folders} | 文件: ${info.files} | 生成时间: ${info.generated}`;
        }

        // 页面加载完毕后执行
        async function init() {
            await loadTree();
            await loadInfo();
        }
    </script>

</head>

<body onload="init()">

    <header>
        <h1>FileMind – 文件思维导图</h1>
        <p id="info-text">加载中……</p>
    </header>

    <div class="markmap">
        <script id="tree-md" type="text/template"></script>
    </div>

</body>

</html>
